{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>ë°©ì¬ìš”ì› í˜„í™© ëŒ€ì‹œë³´ë“œ</h2>
    <form class="d-flex" action="{{ url_for('dashboard') }}">
        <select name="set_id" class="form-select me-2" onchange="this.form.submit()">
            {% for s in sets %}
            <option value="{{ s[0] }}" {% if s[0] == current_set_id %}selected{% endif %}>{{ s[1] }}</option>
            {% endfor %}
        </select>
    </form>
</div>

{% if no_data %}
    <div class="alert alert-warning">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. [ë°ì´í„° ë“±ë¡] ë©”ë‰´ì—ì„œ ëª…ë‹¨ì„ ë¨¼ì € ë“±ë¡í•´ì£¼ì„¸ìš”.</div>
{% else %}
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card p-3 text-center bg-primary text-white">
                <h5>ì´ ëŒ€ìƒ</h5>
                <h2>{{ total }}ëª…</h2>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card p-3 text-center bg-success text-white">
                <h5>êµìœ¡ ì´ìˆ˜</h5>
                <h2>{{ completed }}ëª…</h2>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card p-3 text-center bg-info text-white">
                <h5>ì´ìˆ˜ìœ¨</h5>
                <h2>{{ rate }}%</h2>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card p-3 text-center bg-warning text-dark">
                <h5>ì¬ë‚œì•ˆì „ êµìœ¡</h5>
                <h2>{{ safety_cnt }}ëª…</h2>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="card p-3">
                <h5>ğŸ“Š ì „ì²´ ì´ìˆ˜ í˜„í™©</h5>
                <canvas id="pieChart"></canvas>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card p-3">
                <h5>ğŸ“‰ ì´ìˆ˜ìœ¨ ì €ì¡° ë¶€ì„œ (Top 10)</h5>
                <canvas id="barChart"></canvas>
            </div>
        </div>
    </div>
{% endif %}
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    {% if not no_data %}
    // íŒŒì´ ì°¨íŠ¸
    new Chart(document.getElementById('pieChart'), {
        type: 'doughnut',
        data: {
            labels: ['ì´ìˆ˜', 'ë¯¸ì´ìˆ˜'],
            datasets: [{
                data: [{{ completed }}, {{ total - completed }}],
                backgroundColor: ['#2ecc71', '#e74c3c']
            }]
        }
    });

    // ë§‰ëŒ€ ì°¨íŠ¸
    new Chart(document.getElementById('barChart'), {
        type: 'bar',
        data: {
            labels: {{ dept_labels | tojson }},
            datasets: [{
                label: 'ì´ìˆ˜ìœ¨ (%)',
                data: {{ dept_values | tojson }},
                backgroundColor: '#3498db'
            }]
        },
        options: {
            indexAxis: 'y',
            scales: { x: { beginAtZero: true, max: 100 } }
        }
    });
    {% endif %}
</script>
{% endblock %}