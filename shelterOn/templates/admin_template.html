<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‚¬ê³  í…œí”Œë¦¿ ê´€ë¦¬ - Shelter-On</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">
    <style>
        body { font-family: 'Pretendard', sans-serif; background-color: #f8f9fa; }
        .navbar { background-color: #2c3e50; }
        .card { border-radius: 12px; border: none; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .nav-pills .nav-link { color: #555; font-weight: 500; margin-right: 5px; }
        .nav-pills .nav-link.active { background-color: #2c3e50; }
        .table thead { background-color: #f1f3f5; }
        .type-indicator { font-weight: 800; color: #2c3e50; border-bottom: 2px solid #2c3e50; padding-bottom: 5px; }
    </style>
</head>
<body>

<nav class="navbar navbar-dark mb-4">
    <div class="container">
        <a class="navbar-brand" href="/">ğŸ  Shelter-On ê´€ë¦¬ì</a>
        <div class="d-flex">
            <span class="navbar-text text-white me-3">{{ session.user_name }}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤</span>
            <a href="/incident" class="btn btn-outline-light btn-sm">ì‚¬ê³  ì„ íƒìœ¼ë¡œ</a>
        </div>
    </div>
</nav>

<div class="container">
    <div class="row mb-4">
        <div class="col-12">
            <h3 class="fw-bold mb-3">âš™ï¸ ì‚¬ê³  ìœ í˜•ë³„ ì´ˆê¸° ì„¸íŒ…(í…œí”Œë¦¿) ê´€ë¦¬</h3>
            <p class="text-muted">ì‚¬ê³  ìƒì„± ì‹œ ìë™ìœ¼ë¡œ ë“±ë¡ë  êµ¬í˜¸ì†Œì™€ ì§‘ê²°ì§€ë¥¼ ì‚¬ê³  ìœ í˜•ë³„ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.</p>
        </div>
    </div>

    <ul class="nav nav-pills mb-4" id="pills-tab" role="tablist">
        {% for t in types %}
        <li class="nav-item">
            <a class="nav-link {{ 'active' if t == selected_type else '' }}" 
               href="{{ url_for('admin_template', type=t) }}">{{ t }}</a>
        </li>
        {% endfor %}
    </ul>

    <div class="row">
        <div class="col-lg-6 mb-4">
            <div class="card h-100">
                <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                    <h5 class="mb-0 fw-bold">ğŸ¥ <span class="type-indicator">{{ selected_type }}</span> ê¸°ë³¸ êµ¬í˜¸ì†Œ</h5>
                    <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#addShelterModal">+ ì¶”ê°€</button>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle">
                            <thead>
                                <tr>
                                    <th>êµ¬í˜¸ì†Œëª…</th>
                                    <th>ìˆ˜ìš©ì¸ì›</th>
                                    <th class="text-end">ê´€ë¦¬</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for s in shelters %}
                                <tr>
                                    <td>
                                        <div class="fw-bold">{{ s.name }}</div>
                                        <small class="text-muted">{{ s.address }}</small>
                                    </td>
                                    <td>{{ s.capacity }}ëª…</td>
                                    <td class="text-end">
                                        <button class="btn btn-sm btn-outline-danger" onclick="deleteItem('shelter', {{ s.id }})">ì‚­ì œ</button>
                                    </td>
                                </tr>
                                {% else %}
                                <tr>
                                    <td colspan="3" class="text-center py-4 text-muted">ë“±ë¡ëœ ê¸°ë³¸ êµ¬í˜¸ì†Œê°€ ì—†ìŠµë‹ˆë‹¤.</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-6 mb-4">
            <div class="card h-100">
                <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                    <h5 class="mb-0 fw-bold">ğŸš© <span class="type-indicator">{{ selected_type }}</span> ê¸°ë³¸ ì§‘ê²°ì§€</h5>
                    <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#addAssemblyModal">+ ì¶”ê°€</button>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle">
                            <thead>
                                <tr>
                                    <th>ì§‘ê²°ì§€ëª…</th>
                                    <th>ì •ë¥˜ì¥ë²ˆí˜¸</th>
                                    <th class="text-end">ê´€ë¦¬</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for a in assemblies %}
                                <tr>
                                    <td>
                                        <div class="fw-bold">{{ a.name }}</div>
                                        <small class="text-muted">{{ a.address }}</small>
                                    </td>
                                    <td>{{ a.stop_no or '-' }}</td>
                                    <td class="text-end">
                                        <button class="btn btn-sm btn-outline-danger" onclick="deleteItem('assembly', {{ a.id }})">ì‚­ì œ</button>
                                    </td>
                                </tr>
                                {% else %}
                                <tr>
                                    <td colspan="3" class="text-center py-4 text-muted">ë“±ë¡ëœ ê¸°ë³¸ ì§‘ê²°ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="addShelterModal" tabindex="-1">
    <div class="modal-dialog">
        <form class="modal-content" action="{{ url_for('admin_template') }}" method="POST">
            <input type="hidden" name="action" value="add_shelter">
            <input type="hidden" name="incident_type" value="{{ selected_type }}">
            <div class="modal-header">
                <h5 class="modal-title">[{{ selected_type }}] ê¸°ë³¸ êµ¬í˜¸ì†Œ ì¶”ê°€</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3"><label class="form-label">êµ¬í˜¸ì†Œëª…</label><input type="text" name="name" class="form-control" required></div>
                <div class="mb-3"><label class="form-label">ì£¼ì†Œ</label><input type="text" name="address" class="form-control"></div>
                <div class="row">
                    <div class="col-6 mb-3"><label class="form-label">ìˆ˜ìš©ì¸ì›</label><input type="number" name="capacity" class="form-control"></div>
                    <div class="col-6 mb-3"><label class="form-label">ì „í™”ë²ˆí˜¸</label><input type="text" name="phone" class="form-control"></div>
                </div>
                <div class="row">
                    <div class="col-6 mb-3"><label class="form-label">ìœ„ë„</label><input type="text" name="latitude" class="form-control" placeholder="36.xxxx"></div>
                    <div class="col-6 mb-3"><label class="form-label">ê²½ë„</label><input type="text" name="longitude" class="form-control" placeholder="127.xxxx"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="submit" class="btn btn-primary">ë“±ë¡</button>
            </div>
        </form>
    </div>
</div>

<div class="modal fade" id="addAssemblyModal" tabindex="-1">
    <div class="modal-dialog">
        <form class="modal-content" action="{{ url_for('admin_template') }}" method="POST">
            <input type="hidden" name="action" value="add_assembly">
            <input type="hidden" name="incident_type" value="{{ selected_type }}">
            <div class="modal-header">
                <h5 class="modal-title">[{{ selected_type }}] ê¸°ë³¸ ì§‘ê²°ì§€ ì¶”ê°€</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3"><label class="form-label">ì§‘ê²°ì§€ëª…</label><input type="text" name="name" class="form-control" required></div>
                <div class="mb-3"><label class="form-label">ì£¼ì†Œ</label><input type="text" name="address" class="form-control"></div>
                <div class="mb-3"><label class="form-label">ì •ë¥˜ì¥ë²ˆí˜¸(ì„ íƒ)</label><input type="text" name="stop_no" class="form-control"></div>
                <div class="row">
                    <div class="col-6 mb-3"><label class="form-label">ìœ„ë„</label><input type="text" name="latitude" class="form-control"></div>
                    <div class="col-6 mb-3"><label class="form-label">ê²½ë„</label><input type="text" name="longitude" class="form-control"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="submit" class="btn btn-primary">ë“±ë¡</button>
            </div>
        </form>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    function deleteItem(target, id) {
        if(!confirm('í•´ë‹¹ í…œí”Œë¦¿ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
        
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = "{{ url_for('admin_template') }}";
        
        const actionInput = document.createElement('input');
        actionInput.type = 'hidden';
        actionInput.name = 'action';
        actionInput.value = 'delete_' + target;
        
        const idInput = document.createElement('input');
        idInput.type = 'hidden';
        idInput.name = 'id';
        idInput.value = id;

        const typeInput = document.createElement('input');
        typeInput.type = 'hidden';
        typeInput.name = 'incident_type';
        typeInput.value = "{{ selected_type }}";
        
        form.appendChild(actionInput);
        form.appendChild(idInput);
        form.appendChild(typeInput);
        document.body.appendChild(form);
        form.submit();
    }
</script>
</body>
</html>