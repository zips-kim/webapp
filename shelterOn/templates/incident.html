{% extends "layout.html" %}

{% block title %}ğŸš¨ ì‚¬ê³  ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ{% endblock %}

{% block content %}
<style>
    /* =========================================
       1. ê¸°ë³¸ ë ˆì´ì•„ì›ƒ & ìœ í‹¸ë¦¬í‹°
       ========================================= */
    .dashboard-container {
        max_width: 1400px;
        margin: 0 auto;
        padding: 10px;
        background: #f8fafc; /* ë°°ê²½ìƒ‰ì„ ì•„ì£¼ ì—°í•œ ì¿¨ê·¸ë ˆì´ë¡œ ë³€ê²½í•˜ì—¬ ê¹”ë”í•¨ ë”í•¨ */
        min-height: calc(100vh - 60px);
        font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif;
    }

    /* =========================================
       2. ëŒ€ì‹œë³´ë“œ í—¤ë” ì˜ì—­ (ìˆ˜ì •ë¨)
       ========================================= */
    .dash-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: white;
        padding: 15px 25px;
        border-radius: 16px; /* ë‘¥ê·¼ ëª¨ì„œë¦¬ ê°•í™” */
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); /* ë¶€ë“œëŸ¬ìš´ ê·¸ë¦¼ì */
        margin-bottom: 25px;
        flex-wrap: wrap; /* í™”ë©´ ì‘ì„ ë•Œ ì¤„ë°”ê¿ˆ í—ˆìš© */
        gap: 15px;
    }

    .header-title {
        font-size: 24px;
        font-weight: 800;
        color: #1e293b;
        letter-spacing: -0.5px;
        display: flex;
        align-items: center;
        gap: 12px;
        min-width: 200px;
    }

    /* íƒ­ ë””ìì¸ */
    .status-tabs {
        display: flex;
        background: #f1f5f9;
        padding: 4px;
        border-radius: 10px;
        /* ì¤‘ì•™ ì •ë ¬ ëŠë‚Œì„ ìœ„í•´ ë§ˆì§„ ì¡°ì • */
        margin-right: auto; 
    }

    .status-tab {
        padding: 8px 20px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 700;
        color: #64748b;
        text-decoration: none;
        transition: all 0.2s ease;
    }

    .status-tab.active {
        background: white;
        color: #0f172a;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    .status-tab:hover:not(.active) {
        color: #334155;
        background: rgba(255,255,255,0.6);
    }

    /* [ìˆ˜ì •] ê²€ìƒ‰ì°½ ë° ë²„íŠ¼ ê·¸ë£¹ */
    .action-group {
        display: flex;
        align-items: center;
        gap: 12px; /* ìš”ì†Œ ì‚¬ì´ ê°„ê²© */
    }

    /* ê²€ìƒ‰ í¼ ìŠ¤íƒ€ì¼ë§ */
    .search-form {
        position: relative;
        display: flex;
        align-items: center;
    }

    /* ê²€ìƒ‰ì°½ ë° ë²„íŠ¼ ê·¸ë£¹ */
    .action-group {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    /* ê²€ìƒ‰ í¼ (ìƒëŒ€ ìœ„ì¹˜ ì§€ì •) */
    .search-form {
        position: relative;
        display: flex;
        align-items: center;
    }

    .search-icon-deco {
        position: absolute;
        left: 14px;
        color: #94a3b8;
        font-size: 16px;
        pointer-events: none;
    }

    /* [NEW] X(ì´ˆê¸°í™”) ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .btn-search-clear {
        position: absolute;
        right: 12px;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: #cbd5e0;
        color: white;
        border: none;
        font-size: 12px;
        display: none; /* ê¸°ë³¸ ìˆ¨ê¹€ */
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: background 0.2s;
    }
    .btn-search-clear:hover { background: #94a3b8; }

    .search-input {
        height: 42px;
        /* ì˜¤ë¥¸ìª½ íŒ¨ë”©ì„ ëŠ˜ë ¤ X ë²„íŠ¼ ê³µê°„ í™•ë³´ */
        padding: 0 40px 0 40px; 
        border: 1px solid #e2e8f0;
        border-radius: 10px;
        font-size: 14px;
        width: 240px;
        background: #ffffff;
        color: #1e293b;
        outline: none;
        transition: all 0.2s;
		margin-top:10px;
    }
    
    .search-input:focus {
        border-color: #3b82f6;
        box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
    }
    
    /* ì‹ ê·œ ë“±ë¡ ë²„íŠ¼ */
    .btn-new {
        height: 42px;
        background: #1e293b;
        color: white;
        border: none;
        padding: 0 24px;
        border-radius: 10px;
        font-weight: 700;
        font-size: 14px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: all 0.2s;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        white-space: nowrap;
    }
    .btn-new:hover { 
        background: #0f172a; 
        transform: translateY(-1px);
        box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    }

    /* =========================================
       3. ì¹´ë“œ ê·¸ë¦¬ë“œ & ì»´íŒ©íŠ¸ ì¹´ë“œ ìŠ¤íƒ€ì¼
       ========================================= */
    .card-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 20px;
    }

    .incident-card {
        background: white;
        border-radius: 12px;
        border: 1px solid #e2e8f0;
        overflow: hidden;
        display: flex;
        flex-direction: column;
		
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 2px 4px rgba(0,0,0,0.02);
        position: relative;
    }

    .incident-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 25px -5px rgba(0, 0, 0, 0.1);
        border-color: #cbd5e0;
    }

    /* ìƒë‹¨ ì»¬ëŸ¬ ë¼ì¸ */
    .card-banner { height: 4px; width: 100%; }
    .banner-real { background: linear-gradient(90deg, #ef4444, #b91c1c); }
    .banner-drill { background: linear-gradient(90deg, #3b82f6, #1d4ed8); }

    /* ì¹´ë“œ í—¤ë” */
    .card-header-area {
        padding: 12px 16px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .badge-wrap { display: flex; align-items: center; gap: 6px; }

    /* ë©”ì¸ ë±ƒì§€ */
    .cat-badge {
        font-size: 11px; font-weight: 800; color: white;
        padding: 3px 8px; border-radius: 6px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        letter-spacing: 0.5px;
    }
    .bg-real { background: #ef4444; }
    .bg-drill { background: #3b82f6; }

    /* ìœ í˜• ë±ƒì§€ */
    .type-badge {
        font-size: 11px; font-weight: 700; color: #475569;
        background: #f1f5f9; padding: 3px 8px; border-radius: 6px;
        border: 1px solid #e2e8f0;
    }

    /* ìƒíƒœ í‘œì‹œ */
    .status-indicator {
        display: flex; align-items: center; gap: 5px;
        font-size: 11px; font-weight: 700;
        padding: 4px 10px; border-radius: 20px;
        border: 1px solid;
    }
    .status-active { background: #f0fdf4; color: #15803d; border-color: #bbf7d0; }
    .status-closed { background: #f8fafc; color: #94a3b8; border-color: #e2e8f0; }

    /* í„ìŠ¤ ì• ë‹ˆë©”ì´ì…˜ */
    .pulse-dot { width: 6px; height: 6px; border-radius: 50%; display: block; }
    .dot-active { background: #22c55e; animation: pulse-green 1.5s infinite; }
    .dot-closed { background: #cbd5e0; }

    @keyframes pulse-green {
        0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); }
        70% { transform: scale(1); box-shadow: 0 0 0 5px rgba(34, 197, 94, 0); }
        100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
    }

    /* íƒ€ì´í‹€ ì˜ì—­ */
    .card-title-box { padding: 0 16px 14px 16px; }
    .card-title {
        font-size: 17px; font-weight: 800; color: #1e293b;
        margin-bottom: 5px; line-height: 1.3;
        white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    .card-date {
        font-size: 12px; color: #94a3b8; font-weight: 500;
        display: flex; align-items: center; gap: 4px;
    }

    /* í†µê³„ ê·¸ë¦¬ë“œ */
    .stats-grid {
        display: grid; grid-template-columns: 1fr 1fr;
        gap: 1px; background: #e2e8f0;
        border-top: 1px solid #e2e8f0;
        border-bottom: 1px solid #e2e8f0;
        margin-top: auto;
    }
    .stat-item {
        background: white; padding: 10px;
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        transition: background 0.2s;
    }
    .stat-item:hover { background: #f8fafc; }
    
    .stat-val { font-size: 16px; font-weight: 800; color: #334155; line-height: 1.2; }
    .stat-label { font-size: 11px; color: #64748b; font-weight: 600; margin-top: 2px; }

    /* í•˜ë‹¨ ë²„íŠ¼ ì˜ì—­ */
    .card-actions {
        padding: 10px 16px;
        background: #f8fafc;
        display: flex; gap: 8px; align-items: center;
    }
    
    .btn-main {
        flex: 1; background: #1e293b; color: white; text-align: center;
        padding: 10px; border-radius: 8px; font-weight: 700; font-size: 13px;
        text-decoration: none; transition: background 0.2s;
        border: 1px solid transparent;
    }
    .btn-main:hover { background: #0f172a; }
    
    .btn-settings {
        width: 36px; height: 36px; display: flex; align-items: center; justify-content: center;
        color: #94a3b8; cursor: pointer; border-radius: 8px; transition: all 0.2s;
        border: 1px solid #e2e8f0; background: white; font-size: 14px;
    }
    .btn-settings:hover { color: #475569; border-color: #cbd5e0; background: #f1f5f9; }

    /* í˜ì´ì§€ë„¤ì´ì…˜ */
    .pagination { margin-top: 40px; display: flex; justify-content: center; gap: 6px; }
    .page-num {
        width: 36px; height: 36px; display: flex; align-items: center; justify-content: center;
        border-radius: 8px; background: white; border: 1px solid #e2e8f0;
        color: #64748b; font-weight: 600; text-decoration: none; transition: all 0.2s;
    }
    .page-num.active { background: #0f172a; color: white; border-color: #0f172a; }
    .page-num:hover:not(.active) { background: #f1f5f9; }

    /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
    #customModalOverlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(3px);
        display: none; align-items: center; justify-content: center; z-index: 2000;
    }
    #customModalOverlay.show { display: flex; animation: fadeIn 0.2s; }
    @keyframes fadeIn { from{opacity:0} to{opacity:1} }
    
    .modal-box {
        background: white; width: 95%; max-width: 500px; border-radius: 16px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.2); overflow: hidden;
        animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    }
    @keyframes slideUp { from{transform:translateY(20px); opacity:0} to{transform:translateY(0); opacity:1} }
	
	/* [NEW] ë¼ë””ì˜¤ ë²„íŠ¼ ê·¸ë£¹ ìŠ¤íƒ€ì¼ (ì²´í¬ë°•ìŠ¤ì²˜ëŸ¼ ë³´ì´ê²Œ) */
    .radio-group {
        display: flex;
        gap: 10px;
    }
    
    .radio-group input[type="radio"] {
        display: none; /* ì‹¤ì œ ë¼ë””ì˜¤ ë²„íŠ¼ ìˆ¨ê¹€ */
    }
    
    .radio-group label {
        flex: 1;
        padding: 12px;
        border: 1px solid #cbd5e0;
        border-radius: 8px;
        text-align: center;
        cursor: pointer;
        font-weight: 700;
        font-size: 14px;
        color: #64748b;
        background: white;
        transition: all 0.2s;
    }

    /* í›ˆë ¨ ì„ íƒ ì‹œ ìŠ¤íƒ€ì¼ */
    .radio-group input[value="í›ˆë ¨"]:checked + label {
        background: #eff6ff;
        color: #3b82f6;
        border-color: #3b82f6;
        box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
    }

    /* ì‹¤ì œì‚¬ê³  ì„ íƒ ì‹œ ìŠ¤íƒ€ì¼ */
    .radio-group input[value="ì‹¤ì œì‚¬ê³ "]:checked + label {
        background: #fef2f2;
        color: #ef4444;
        border-color: #ef4444;
        box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.2);
    }
    
</style>

<div class="dashboard-container">
    
    <div class="dash-header">
        <div class="header-title">
            ğŸš¨ ì‚¬ê³  ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ
        </div>
        
        <div class="status-tabs">
            <a href="/?status=ACTIVE" class="status-tab {{ 'active' if current_status == 'ACTIVE' else '' }}">
                ğŸ”¥ ì§„í–‰ì¤‘ ({{ cnt_active }})
            </a>
            <a href="/?status=CLOSED" class="status-tab {{ 'active' if current_status == 'CLOSED' else '' }}">
                ğŸ ì¢…ë£Œë¨ ({{ cnt_closed }})
            </a>
        </div>

        <div class="action-group">
            <form action="/" method="GET" class="search-form" id="searchForm">
                <input type="hidden" name="status" value="{{ current_status }}">
                <span class="search-icon-deco">ğŸ”</span>
                <input type="text" name="search" id="searchInput" class="search-input" 
                       placeholder="ì‚¬ê³ ëª… ê²€ìƒ‰..." value="{{ search }}" autocomplete="off"
                       oninput="toggleClearBtn()">
                
                <button type="button" id="btnSearchClear" class="btn-search-clear" onclick="clearSearch()">âœ•</button>
            </form>
            
            {% if session.role_level <= 2 %}
            <button onclick="openModal()" class="btn-new">
                <span>+</span> <span>ì‹ ê·œ ë“±ë¡</span>
            </button>
            {% endif %}
        </div>
    </div>

    <div class="card-grid">
        {% for inc in incidents %}
        <div class="incident-card">
            <div class="card-banner {{ 'banner-real' if inc.incident_category == 'ì‹¤ì œì‚¬ê³ ' else 'banner-drill' }}"></div>

            <div class="card-header-area">
                <div class="badge-wrap">
					<span class="type-badge">
                        {{ inc.incident_category }}
                    </span>
                    <span class="cat-badge {{ 'bg-real' if inc.incident_category == 'ì‹¤ì œì‚¬ê³ ' else 'bg-drill' }}">
                        {{ inc.incident_type }}
                    </span>
					<div class="card-date">
						<span>ğŸ•’</span> {{ inc.incident_time or 'ì‹œê°„ ë¯¸ì •' }}
					</div>
                </div>
                
                <div class="status-indicator {{ 'status-active' if inc.status == 'ACTIVE' else 'status-closed' }}">
                    <span class="pulse-dot {{ 'dot-active' if inc.status == 'ACTIVE' else 'dot-closed' }}"></span>
                    {{ 'ì§„í–‰ì¤‘' if inc.status == 'ACTIVE' else 'ì¢…ë£Œ' }}
                </div>
            </div>

            <div class="card-title-box">
                <div class="card-title">{{ inc.title }}</div>
                
            </div>

            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-val">{{ inc.stat_shelters }}</div>
                    <div class="stat-label">ğŸ¥ êµ¬í˜¸ì†Œ</div>
                </div>
                <div class="stat-item">
                    <div class="stat-val">{{ inc.stat_assemblies }}</div>
                    <div class="stat-label">ğŸš© ì§‘ê²°ì§€</div>
                </div>
                <div class="stat-item">
                    <div class="stat-val" style="color:#2563eb;">{{ inc.stat_residents | format_number }}</div>
                    <div class="stat-label">ğŸ‘¥ ì´ì¬ë¯¼</div>
                </div>
                <div class="stat-item">
                    <div class="stat-val" style="color:#059669;">{{ inc.stat_supplies | format_number }}</div>
                    <div class="stat-label">ğŸ“¦ êµ¬í˜¸ë¬¼í’ˆ</div>
                </div>
            </div>

            <div class="card-actions">
                <a href="{{ url_for('view_map', incident_id=inc.id) }}" class="btn-main">
                    ì‹œìŠ¤í…œ ì ‘ì† âœ
                </a>
                {% if session.role_level <= 2 %}
                <div style="position:relative;">
                    <button class="btn-settings" onclick="toggleMenu(this)">âš™ï¸</button>
                    <div class="menu-dropdown" style="display:none; position:absolute; bottom:110%; right:0; background:white; border:1px solid #e2e8f0; border-radius:10px; width:130px; box-shadow:0 10px 25px rgba(0,0,0,0.1); z-index:10; overflow:hidden;">
                        <a href="{{ url_for('toggle_incident_status', incident_id=inc.id) }}" 
                           onclick="return confirm('ìƒíƒœë¥¼ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')"
                           style="display:block; padding:12px; text-decoration:none; color:#334155; font-size:12px; font-weight:600; border-bottom:1px solid #f1f5f9;">
                           {{ 'ğŸ ì¢…ë£Œ ì²˜ë¦¬' if inc.status == 'ACTIVE' else 'ğŸ”„ ë‹¤ì‹œ ì¬ê°œ' }}
                        </a>
                        <form action="{{ url_for('manage_incident') }}" method="POST" onsubmit="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ë°ì´í„°ê°€ ëª¨ë‘ ì‚¬ë¼ì§‘ë‹ˆë‹¤.');">
                            <input type="hidden" name="action" value="delete">
                            <input type="hidden" name="incident_id" value="{{ inc.id }}">
                            <button type="submit" style="width:100%; text-align:left; background:none; border:none; padding:12px; color:#ef4444; font-weight:700; cursor:pointer; font-size:12px;">ğŸ—‘ï¸ ì‚­ì œí•˜ê¸°</button>
                        </form>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
        {% else %}
        <div style="grid-column: 1/-1; text-align:center; padding:60px; color:#94a3b8;">
            <div style="font-size:48px; margin-bottom:15px; opacity:0.5;">ğŸ“‚</div>
            <div style="font-size:16px;">ë“±ë¡ëœ ì‚¬ê³  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
        </div>
        {% endfor %}
    </div>

    {% if pagination.pages > 1 %}
    <div class="pagination">
        {% if pagination.has_prev %}
        <a href="{{ url_for('incident', page=pagination.prev_num, status=current_status, search=search) }}" class="page-num">&lt;</a>
        {% endif %}
        {% for p in pagination.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
            {% if p %}
                <a href="{{ url_for('incident', page=p, status=current_status, search=search) }}" class="page-num {{ 'active' if p == pagination.page else '' }}">{{ p }}</a>
            {% else %}
                <span class="page-num" style="border:none">...</span>
            {% endif %}
        {% endfor %}
        {% if pagination.has_next %}
        <a href="{{ url_for('incident', page=pagination.next_num, status=current_status, search=search) }}" class="page-num">&gt;</a>
        {% endif %}
    </div>
    {% endif %}

</div>

<div id="customModalOverlay" onclick="if(event.target === this) closeCustomModal()">
    <div class="modal-box">
		<form action="{{ url_for('manage_incident') }}" method="POST">
			<input type="hidden" name="action" value="create">
			
			<div style="padding: 24px; background: #0f172a; color: white; display: flex; justify-content: space-between; align-items: center;">
				<h3 style="margin:0; font-size:18px; font-weight:800;">ğŸš€ ì‹ ê·œ ì‚¬ê³  ê´€ì œ ë“±ë¡</h3>
				<span style="cursor:pointer; font-size:24px; opacity:0.7;" onclick="closeCustomModal()">&times;</span>
			</div>
			
			<div style="padding: 30px;">
				<div style="margin-bottom:25px;">
					<label style="display:block; font-size:13px; font-weight:700; color:#64748b; margin-bottom:8px;">ì‚¬ê³  êµ¬ë¶„</label>
					<div class="radio-group">
						<input type="radio" id="cat_drill" name="incident_category" value="í›ˆë ¨" checked>
						<label for="cat_drill">ğŸ”µ í›ˆë ¨</label>

						<input type="radio" id="cat_real" name="incident_category" value="ì‹¤ì œì‚¬ê³ ">
						<label for="cat_real">ğŸ”´ ì‹¤ì œì‚¬ê³ </label>
					</div>
				</div>
				
				<div style="margin-bottom:20px;">
					<label style="display:block; font-size:13px; font-weight:700; color:#64748b; margin-bottom:6px;">ì‚¬ê³  ëª…ì¹­</label>
					<input type="text" name="title" placeholder="ì˜ˆ: 2026 ìœ ì„±êµ¬ ë°©ì¬ í›ˆë ¨" required
						   style="width:100%; padding:12px; border:1px solid #cbd5e0; border-radius:8px; font-size:14px; box-sizing: border-box;">
				</div>
				
				<div style="display:flex; gap:15px; margin-bottom:20px;">
					<div style="flex:1;">
						<label style="display:block; font-size:13px; font-weight:700; color:#64748b; margin-bottom:6px;">ìœ í˜•</label>
						<select name="incident_type" style="width:100%; padding:12px; border:1px solid #cbd5e0; border-radius:8px; font-size:14px;">
							{% for type in incident_types %}
								<option value="{{ type }}">{{ type }}</option>
							{% endfor %}
						</select>
					</div>
					
					<div style="flex:1.5;">
						<label style="display:block; font-size:13px; font-weight:700; color:#64748b; margin-bottom:6px;">ë°œìƒ ì¼ì‹œ</label>
						<input type="text" name="incident_time" 
							   style="width:100%; padding:12px; border:1px solid #cbd5e0; border-radius:8px; font-size:14px; box-sizing: border-box;">
					</div>
				</div>

				<div style="background:#f0f9ff; padding:15px; border-radius:8px; font-size:13px; color:#0369a1; line-height:1.5; border:1px solid #bae6fd;">
					<b>ğŸ’¡ ìë™ ì„¸íŒ… ì•ˆë‚´</b><br>
					ì‚¬ê³ ë¥¼ ìƒì„±í•˜ë©´ ì„ íƒí•œ ìœ í˜•ì— ë§ëŠ” <u>í‘œì¤€ êµ¬í˜¸ì†Œ ë° ì§‘ê²°ì§€ ë°ì´í„°</u>ê°€ ìë™ìœ¼ë¡œ ë³µì‚¬ë˜ì–´ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.
				</div>
			</div>
			
			<div style="padding: 20px 30px; background: #f8fafc; display: flex; justify-content: flex-end; gap: 10px; border-top: 1px solid #e2e8f0;">
				<button type="button" onclick="closeCustomModal()" style="padding: 12px 24px; border: 1px solid #cbd5e0; background: white; border-radius: 8px; font-weight:700; color:#475569; cursor: pointer;">ì·¨ì†Œ</button>
				<button type="submit" style="padding: 12px 24px; background: #0f172a; color: white; border: none; border-radius: 8px; font-weight: 700; cursor: pointer;">ìƒì„±í•˜ê¸°</button>
			</div>
		</form>
	</div>
</div>

<script>
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ê²€ìƒ‰ì–´ ìˆìœ¼ë©´ Xë²„íŠ¼ í‘œì‹œ
    document.addEventListener("DOMContentLoaded", function() {
        toggleClearBtn();
    });

    function toggleClearBtn() {
        const input = document.getElementById('searchInput');
        const btn = document.getElementById('btnSearchClear');
        if(input.value.length > 0) {
            btn.style.display = 'flex';
        } else {
            btn.style.display = 'none';
        }
    }

    function clearSearch() {
        const input = document.getElementById('searchInput');
        input.value = '';
        toggleClearBtn();
        // ê²€ìƒ‰ì–´ ì´ˆê¸°í™” í›„ í¼ ì œì¶œ (ë¦¬ì…‹)
        document.getElementById('searchForm').submit();
    }

    function openModal() {
        const now = new Date();
        const formattedTime = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')} ${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
        const timeInput = document.querySelector('input[name="incident_time"]');
        if (timeInput && !timeInput.value) timeInput.value = formattedTime;
        document.getElementById('customModalOverlay').classList.add('show');
    }

    function closeCustomModal() {
        document.getElementById('customModalOverlay').classList.remove('show');
    }

    // ë©”ë‰´ í† ê¸€
    function toggleMenu(btn) {
        event.stopPropagation();
        const menu = btn.nextElementSibling;
        const isVisible = menu.style.display === 'block';
        document.querySelectorAll('.menu-dropdown').forEach(m => m.style.display = 'none');
        menu.style.display = isVisible ? 'none' : 'block';
    }

    document.addEventListener('click', function() {
        document.querySelectorAll('.menu-dropdown').forEach(m => m.style.display = 'none');
    });
    
    document.addEventListener('keydown', function(event) {
        if (event.key === "Escape") closeCustomModal();
    });
</script>
{% endblock %}