<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Flexible</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { display: flex; min-height: 100vh; }
        .sidebar { min-width: 250px; background: #343a40; color: white; padding: 20px; }
        .sidebar a { color: #ddd; text-decoration: none; display: block; padding: 10px; }
        .sidebar a:hover { background: #495057; color: white; }
        .content { flex-grow: 1; padding: 30px; }
    </style>
</head>
<body>
    <div class="sidebar">
        <h4><a href="/">ğŸš€ Flexible</a></h4>
        <hr>
		{% if current_user.is_authenticated %}
			<div class="mb-3 p-2 bg-secondary bg-opacity-25 rounded text-center">
				<span class="d-block small text-muted">ì ‘ì†ì¤‘</span>
				<strong>ğŸ‘¤ {{ current_user.name }}</strong> ë‹˜
				<a href="{{ url_for('flexible.logout') }}" class="btn btn-danger btn-sm w-100 mt-2">ë¡œê·¸ì•„ì›ƒ</a>
			</div>
		{% else %}
			<div class="mb-3">
				<a href="{{ url_for('flexible.login') }}" class="btn btn-primary w-100">ğŸ” ë¡œê·¸ì¸</a>
			</div>
		{% endif %}
		
        <ul class="nav nav-pills flex-column mb-auto">
    
			{% macro render_sidebar(items, level=0) %}
				{% for item in items %}
					<li class="nav-item">
						<a href="{{ item.url }}" 
						   class="nav-link text-white d-flex align-items-center {{ 'active bg-primary' if request.path == item.url else '' }}"
						   style="padding-left: {{ 10 + (level * 15) }}px; transition: all 0.2s;">
							
							<span class="me-2 opacity-75">
								{% if item.icon %}
                                    {# [ìˆ˜ì •] ì´ë¯¸ì§€ í™•ì¥ìì¸ ê²½ìš°ë§Œ img íƒœê·¸ ì‚¬ìš©, ë‚˜ë¨¸ì§€ëŠ” í…ìŠ¤íŠ¸(ì´ëª¨ì§€)ë¡œ ì¶œë ¥ #}
                                    {% if '.' in item.icon and item.icon.lower().endswith(('.png', '.jpg', '.jpeg', '.gif', '.svg', '.ico')) %}
									    <img src="{{ item.icon }}" width="16" height="16"> 
                                    {% else %}
                                        {{ item.icon }}
                                    {% endif %}
                                {% elif item.children %}ğŸ“‚
								{% elif item.type == 'system' %}ğŸ”—
								{% else %}ğŸ“„{% endif %}
							</span>
							
							<span class="text-truncate">{{ item.title }}</span>
							
							{% if item.children %}
								<small class="ms-auto opacity-50" style="font-size: 0.7em;">â–¼</small>
							{% endif %}
						</a>

						{% if item.children %}
							<ul class="nav flex-column ms-3 border-start border-secondary border-opacity-25 mb-1" style="list-style: none; padding-left: 0;">
								{{ render_sidebar(item.children, level + 1) }}
							</ul>
						{% endif %}
					</li>
				{% endfor %}
			{% endmacro %}

			{{ render_sidebar(menu_tree) }}

			{% if not menu_tree %}
				<li class="nav-item p-3 text-center text-secondary small">
					ë©”ë‰´ê°€ ì—†ìŠµë‹ˆë‹¤.<br>
					<a href="{{ url_for('flexible.manage_menus') }}" class="text-white text-decoration-underline">ë©”ë‰´ ì„¤ì •</a>ì—ì„œ ì¶”ê°€í•˜ì„¸ìš”.
				</li>
			{% endif %}
		</ul>
		{# [ê¶Œí•œ ì ìš©] ê´€ë¦¬ìë§Œ 'ì „ì²´ ì‚­ì œ' ë©”ë‰´ ë³´ì„ #}
		{% if current_user.is_admin %}
		<hr class="mt-4">
		<a href="{{ url_for('flexible.manage_menus') }}" class="text-warning d-flex align-items-center gap-2">
			<span>âš™ï¸</span> ë©”ë‰´ ê´€ë¦¬
		</a>
		
		<a href="{{ url_for('flexible.create_form') }}" class="text-secondary d-flex align-items-center gap-2">
			<span>â•</span> ì‹œìŠ¤í…œ ì •ì˜
		</a>
		{% endif %}
	</div>

    <div class="content">
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, message in messages %}
              <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
              </div>
            {% endfor %}
          {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>